#!/usr/bin/env python
import sys
import os

numberArg = len(sys.argv)
arg1 = str(sys.argv[0])
arg2 = str(sys.argv[1])
arg3 = str(sys.argv[2])
arg4 = str(sys.argv[3])

if(numberArg == 1):
    if(arg1 == "-h"):
        print("Compress: ivc [namaFile.mp4]\nContoh  : ivc sample.mp4\n\nTrim  : ivc -t [Waktu awal] [Waktu akhir] [namaFile.mp4]\nContoh: ivc -t 00:01:00 00:02:30 sample.mp4\n\nMembatalkan proses kompres: Ctrl + C")
    else:
        namaFile = arg1
        output = os.system(f"${namaFile%.*}")
        os.system(f'ffmpeg -i "{namaFile}" -c:v libx264 -c:a copy -crf 20 -preset veryfast -metadata comment="Compressed by Instant Video Compressor" "{output}_compressed.mp4')
        os.system("clear")
        print("Proses kompres selesai")
if(numberArg == 4):
    if(arg1 == "-t"):
		waktuMulai = arg2
        waktuMulaiSec = os.system(f"$(echo {waktuMulai} | awk -F: '{ print ($1 * 3600) + ($2 * 60) + $3 }')")
        waktuMulaiSec2 = os.system(f"$(echo {waktuMulai} | awk -F: '{ print ($1 * 3600) + ($2 * 60) + $3 - 1 }')")
		waktuSelesai = arg3
		waktuSelesaiSec = os.system(f"$(echo {waktuSelesai} | awk -F: '{ print ($1 * 3600) + ($2 * 60) + $3 }')")
		akhir = os.system(f"$(expr {waktuSelesaiSec} - {waktuMulaiSec})")

		namaFile=$4
		output=${namaFile%.*}
    ffmpeg -ss $waktuMulaiSec2 -i "$namaFile" -ss 1 -t $akhir -c:v libx264 -crf 20 -preset veryfast -c:a copy -metadata comment="Compressed & trimmed by Instant Video Compressor" "${output}_trimmed.mp4"
		clear
		echo -e "\nProses kompres & trim selesai!"




if [ $# -eq 1 ]; then
 	if [ "$1" == "-h" ]; then
		echo -e "Compress: ivc [namaFile.mp4]\nContoh  : ivc sample.mp4\n\nTrim  : ivc -t [Waktu awal] [Waktu akhir] [namaFile.mp4]\nContoh: ivc -t 00:01:00 00:02:30 sample.mp4\n\nMembatalkan proses kompres: Ctrl + C"
	else
		namaFile=$1
		output=${namaFile%.*}
		ffmpeg -i "$namaFile" -c:v libx264 -c:a copy -crf 20 -preset veryfast -metadata comment="Compressed by Instant Video Compressor" "${output}_compressed.mp4"
		#echo $output
		clear
		echo -e "\nProses kompres selesai!"
	fi
elif [ $# -eq 4 ]; then
	if [ "$1" == "-t" ]; then
		waktuMulai=$2
    waktuMulaiSec=$(echo $waktuMulai | awk -F: '{ print ($1 * 3600) + ($2 * 60) + $3 }')
  	waktuMulaiSec2=$(echo $waktuMulai | awk -F: '{ print ($1 * 3600) + ($2 * 60) + $3 - 1 }')
		waktuSelesai=$3
		waktuSelesaiSec=$(echo $waktuSelesai | awk -F: '{ print ($1 * 3600) + ($2 * 60) + $3 }')
		akhir=$(expr $waktuSelesaiSec - $waktuMulaiSec)

		namaFile=$4
		output=${namaFile%.*}
    ffmpeg -ss $waktuMulaiSec2 -i "$namaFile" -ss 1 -t $akhir -c:v libx264 -crf 20 -preset veryfast -c:a copy -metadata comment="Compressed & trimmed by Instant Video Compressor" "${output}_trimmed.mp4"
		clear
		echo -e "\nProses kompres & trim selesai!"
	fi
fi
